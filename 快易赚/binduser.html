<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="format-detection" content="telephone=no,email=no,adress=no"/>
<title>绑定</title>
<link rel="stylesheet" type="text/css" href="css/common.css" />
<script type="text/javascript" src="script/jquery.js"></script>
<script>
	var username,password;
</script>
</head>
<body>
<!-- 页面头部 -->
<section>
  <div class="navigation-bar"> <a href="#" class="z-01"></a> <span>请绑定手机号</span> <a href="#" class="z-02"></a> </div>
</section>
<!-- 中间内容 -->
<div class="register">

  <div class="wrapper-reg">
    <div class="page-header"> <a href="/"> <img src="images/reg-logo.png"> </a> </div>
    <div class="page-main">
      <form action="" method="post" id="user-login-form" accept-charset="UTF-8" class="reg-form">
        <div class="m-field">
          <div class="iconuser"></div>
          <input id="j_username" type="text" name="j_username"  class="c-txt" maxlength="26" onBlur="return checkUsername()" placeholder="请输入手机号" style="color: rgb(74, 74, 74);">
          <p id="j_usernameErrorDiv"></p>
        </div>
        <div class="m-field" style="display: none;" id="site">
          <div class="iconpwd"></div>
          <input id="j_password2" type="text" name="j_password2"  class="c-txt" maxlength="26" style="background-position: 0 -472px;" placeholder="请输入密码">
          <input id="j_password" type="password" name="j_password" value="" maxlength="26" onBlur="checkPassword()" style="display: none;" class="c-txt" placeholder="请输入密码">
          <p id="j_passwordErrorDiv"></p>
        </div>

        <div class="remember">
        <span id="hidden">
        	
        </span>
        <input class="btn-submit" style="border:none; cursor:pointer;display: none;" type="button" value="确认绑定" onClick="">
      		
      </form>
    </div>
  </div>
 <center><span id="code"></span></center>
</div>

<script>
		//<![CDATA[
		           var loginError = false;
		           
		           var pwdFlag = false;
		           var codeFlag = false;
		           
		          //验证用户名
				  function checkUsername(){

					  var usernameRegex="^[a-zA-Z0-9\u4E00-\u9FA5_]+$";
					  var mobileOrEmailRegex="^((1[3|4|5|8][0-9]{9})|(([a-zA-Z0-9]+[_|\-|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}))$";
					  username=$("#j_username").val();
					  var nullFlag=(username==""||username=="请输入用户名/手机号/邮箱");
					  if(nullFlag==true)
					  {
						  $("#j_usernameErrorDiv").html("请输入手机号");
						  return false;
					  }
					  else
					  {
						  $("#j_usernameErrorDiv").html("");
					  }
					  var usernamePattern=new RegExp(usernameRegex);
					  var usernameFlag=usernamePattern.test(username);
					  var mobileOrEmailPattern=new RegExp(mobileOrEmailRegex);
					  var mobileOrEmailFlag=mobileOrEmailPattern.test(username);
//					  var usernameFlag=validateInputLength(username,'请输入用户名/手机号/邮箱','2','1','4','128');
					  var legalFlag=usernameFlag||mobileOrEmailFlag||usernameFlag;
					  if(!legalFlag)
					  {
						  $("#j_usernameErrorDiv").html("");
						  $("#j_usernameErrorDiv").html("4位以上字母、数字、汉字或下划线的组合");
						  return false;
					  }
					  else
					  {
						  $("#j_usernameErrorDiv").html("");
					  }
					  return true;
				  }
		          //验证密码
		          function checkPassword(){
//		        	  var passwordRegex="^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,26}$";
		        	   password=$("#j_password").val();
		        	   
		        	  var nullFlag=(password==""||password=="请输入密码");
					  if(nullFlag==true){
						  $("#j_passwordErrorDiv").empty();
						  $("#j_passwordErrorDiv").html("密码不能为空");
						  return false;
					  }else{
						  $("#j_passwordErrorDiv").empty();
					  }
//		        	  var passwordPattern = new RegExp(passwordRegex);
//		        	  var legalFlag=passwordPattern.test(password);
//		        	  if(legalFlag==false){
//		        		  $("#j_passwordErrorDiv").empty();
//						  $("#j_passwordErrorDiv").html("用户名或者密码输入错误");
//						  return false;		
//		        	  }else{
//		        		  $("#j_passwordErrorDiv").empty();
//		        	  } 
		        	  return true;
		          }
		          	function GetQueryString(name)
        			{
			            var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
			            var r = window.location.search.substr(1).match(reg);
			            if(r!=null)return  unescape(r[2]); return null;
        			}
		  		
		    	var appid=GetQueryString('openid');
		    	var type=GetQueryString('type');
		          
		          
		          //登录验证
		          function loginCheckAll(){
		          	  var userNameFlag3 = checkUsername();
		        	  var passWordFlag=checkPassword();
		        	  var authFlag = checkAuthcode();
					  $("#j_yzmErrorDiv").empty();
		        	  if(userNameFlag3&&passWordFlag&&authFlag){
		        		  $("#user-login-form").submit();
		        	  }
		        	  remeberName();
		          }


//----------登陆页记住用户名js部分----------------------------------------------------------------------------------		         
		</script>
<script type="text/javascript" src="script/jsf.js.htm"></script>
<script language="JavaScript" type="text/javascript"> 
			   	 $("#j_username").focusin(function(){
			   	 	if($("#j_username").val() == "请输入手机号") {
				   	 	$("#j_username").val("");
				   	 	$("#j_username").css("color","#4a4a4a");
			   	 	}
			   	 }).focusout(function(){
			   	 	if($("#j_username").val() == "" ||$("#j_username").val() == "请输入用户名/手机号/邮箱"){ 
			   	 		$("#j_username").val("请输入用户名/手机号/邮箱").css("color", "#c3c3c3");
			   	 	}else{
			   	 		$("#j_username").css("color","#4a4a4a");
			   	 	}
			   	 });
			   	 $("#j_username").blur(function(){
			   	 	var j_username=$("#j_username").val();
			   	 	if(j_username=="" || j_username=="请输入手机号" || j_username=="请输入用户名/手机号/邮箱"){
			   	 		return false;
			   	 	}
			   	 	$.ajax({
			   	 		type:"get",
			            url:"http://www.mywebsitezhang.xin/index.php/index/user/selecttel",
			   	 		data:{"tel":j_username},
			   	 		dataType:"jsonp",
			   	 		async:false,
			   	 		jsonp:"callback",
			   	 		success:function(msg){
			   	 			if(msg.code=="1007"){
			   	 				$(".m-field").show();
			   	 				$("#hidden").html("<input type='hidden' id='abstr' value='1' />");
			   	 				$(".btn-submit").show();
			   	 				return false;
			   	 			}else{
			   	 				$("#site").hide();
			   	 				$(".btn-submit").show();
			   	 				$("#hidden").html("");
			   	 				return true;
			   	 			}
			   	 		}
			   	 	});
			   	 })
			   	 $(".btn-submit").click(function(){
			   	 	var tel=$("#j_username").val();
			   	 	var type=GetQueryString("type");
			   	 	//判断一个表单是否存在
			   	 	var openid=GetQueryString("openid");
			   	 	var type=GetQueryString("type");
			   	 	var password="";
			   	 	if($("#abstr").length>0){
			   	 		//存在隐藏域说明是没有注册
			   	 		var password=$("#j_password2").val();
			   	 		var openid=GetQueryString("openid");
			   	 		if(password==""){
                            $("#code").html("<font style='color: red;'>密码不能为空!</font>").show(400).delay(400).hide(400); 
			   	 			return false;
			   	 		}
			   	 	}
			   	 	$.ajax({
			   	 		type:"get",
			   	 		url:"http://www.mywebsitezhang.xin/index.php/index/user/binduser",
			   	 		data:{"tel":tel,"password":password,"openid":openid,"type":type},
			   	 		dataType:"jsonp",
			   	 		jsonp:"callback",
			   	 		success:function(msg){
			   	 			console.log(msg);
			   	 			if(msg.code=="200"){
			   	 				$("#code").html("<font style='color: red;'>绑定成功!</font>").show(400).delay(400).hide(400);
			   	 				sessionStorage.setItem("userid",msg.msg)
			   	 				location.href="./index.html";
			   	 			
			   	 			}else{
			   	 				 $("#code").html("<font style='color: red;'>绑定失败!</font>").show(400).delay(400).hide(400);
			   	 				return false;
			   	 			}
			   	 		}
			   	 	});
			   	 	
			   	 })
 			</script>
</body>
</html>
